<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jira Analytics Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts@2.5.0/umd/Recharts.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better visual appeal */
        .chart-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #3b82f6;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #10b981;
        }
        
        input:checked + .slider:before {
            transform: translateX(20px);
        }

        /* Fallback chart styles */
        .chart-fallback {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: 500;
        }

        /* Hide browser extension autofill overlays */
        [data-lastpass-icon-root], 
        [data-lastpass-root], 
        [id^="__BITWARDEN"], 
        [data-bitwarden], 
        div[style*="z-index: 2147483647"] {
            display: none !important;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Prevent extension context errors -->
    <script>
        // Suppress extension-related errors
        window.addEventListener('error', function(e) {
            if (e.message && (
                e.message.includes('Extension context invalidated') ||
                e.message.includes('autofill') ||
                e.message.includes('lastpass') ||
                e.message.includes('bitwarden')
            )) {
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        });
    </script>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Check if Recharts loaded properly, otherwise use fallbacks
        const ChartsAvailable = typeof Recharts !== 'undefined' && Recharts.LineChart;
        
        // Recharts components or fallbacks
        const LineChart = ChartsAvailable ? Recharts.LineChart : ({ children, data, ...props }) => (
            <div className="chart-fallback" style={{ height: props.height || 300 }}>
                ðŸ“ˆ Line Chart: {data?.length || 0} data points
            </div>
        );
        
        const BarChart = ChartsAvailable ? Recharts.BarChart : ({ children, data, ...props }) => (
            <div className="chart-fallback" style={{ height: props.height || 300 }}>
                ðŸ“Š Bar Chart: {data?.length || 0} data points  
            </div>
        );
        
        const Line = ChartsAvailable ? Recharts.Line : () => null;
        const Bar = ChartsAvailable ? Recharts.Bar : () => null;
        const XAxis = ChartsAvailable ? Recharts.XAxis : () => null;
        const YAxis = ChartsAvailable ? Recharts.YAxis : () => null;
        const CartesianGrid = ChartsAvailable ? Recharts.CartesianGrid : () => null;
        const Tooltip = ChartsAvailable ? Recharts.Tooltip : () => null;
        const Legend = ChartsAvailable ? Recharts.Legend : () => null;
        const ResponsiveContainer = ChartsAvailable ? Recharts.ResponsiveContainer : ({ children, width, height }) => (
            <div style={{ width: width || '100%', height: height || 300 }}>
                {children}
            </div>
        );

        // Icons as simple SVG components
        const DatabaseIcon = () => (
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4" />
            </svg>
        );

        const RefreshIcon = ({ spinning }) => (
            <svg className={`w-4 h-4 ${spinning ? 'animate-spin' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
        );

        const SettingsIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        );

        const CheckIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
            </svg>
        );

        const XIcon = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
        );

        const AlertIcon = () => (
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.348 16.5c-.77.833.192 2.5 1.732 2.5z" />
            </svg>
        );

        const TrendingIcon = () => (
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
            </svg>
        );

        const ClockIcon = () => (
            <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        // Main Application Component
        const JiraAnalyticsApp = () => {
            const [loading, setLoading] = useState(false);
            const [connectionStatus, setConnectionStatus] = useState('disconnected');
            const [lastSync, setLastSync] = useState(null);
            const [realData, setRealData] = useState(null);
            const [error, setError] = useState(null);
            const [showConfig, setShowConfig] = useState(false);
            const [isProductionMode, setIsProductionMode] = useState(false);
            const [cacheStatus, setCacheStatus] = useState(null);

            // Load saved config from localStorage
            const loadSavedConfig = () => {
                try {
                    const saved = localStorage.getItem('jiraConfig');
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        return {
                            baseUrl: parsed.baseUrl || 'https://komutel.atlassian.net',
                            email: parsed.email || 'robert.mohid@versaterm.com',
                            apiToken: parsed.apiToken || '',
                            project: parsed.project || 'KSD',
                            jqlQuery: parsed.jqlQuery || 'project = KSD AND cf[11129] > 0 AND created >= -30d ORDER BY created DESC'
                        };
                    }
                } catch (e) {
                    console.error('Error loading saved config:', e);
                }
                return {
                    baseUrl: 'https://komutel.atlassian.net',
                    email: 'robert.mohid@versaterm.com',
                    apiToken: '',
                    project: 'KSD',
                    jqlQuery: 'project = KSD AND cf[11129] > 0 AND created >= -30d ORDER BY created DESC'
                };
            };

            // Jira configuration
            const [jiraConfig, setJiraConfig] = useState(loadSavedConfig());

            // Time period and interval settings
            const [timePeriod, setTimePeriod] = useState('30d'); // 7d, 30d, 90d, 180d, 365d, custom
            const [timeInterval, setTimeInterval] = useState('daily'); // daily, weekly, monthly
            const [customDays, setCustomDays] = useState(30);

            // Production API calls (would connect to real backend)
            const productionJiraAPI = async (endpoint, data = {}) => {
                try {
                    const response = await fetch(`http://localhost:3001/api/jira/${endpoint}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Backend API error: ${response.status}`);
                    }
                    
                    return await response.json();
                } catch (err) {
                    throw new Error('Backend not available. Run server.js first or switch to Demo mode.');
                }
            };

            // Demo data simulation
            const simulateJiraAPI = async (endpoint, data = {}) => {
                await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
                
                if (Math.random() < 0.05) {
                    throw new Error('Simulated network timeout - please try again');
                }

                if (endpoint === 'test-connection') {
                    if (!data.apiToken || data.apiToken.length < 10) {
                        throw new Error('Invalid API token - must be at least 10 characters');
                    }
                    return {
                        success: true,
                        user: { displayName: 'Robert Mohid', emailAddress: data.email }
                    };
                }

                if (endpoint === 'current-tickets') {
                    const generateTickets = (count, priorityCategory, priorityRange) => {
                        const tickets = [];
                        const statuses = ['Open', 'In Progress', 'Code Review', 'Testing', 'Blocked'];
                        const summaries = [
                            'Database performance optimization needed',
                            'User authentication system enhancement',
                            'API rate limiting implementation',
                            'Frontend responsive design fixes',
                            'Memory leak investigation in production',
                            'Integration test automation setup',
                            'Security vulnerability assessment',
                            'Third-party library version updates',
                            'Error handling improvement in checkout',
                            'Load balancer configuration review'
                        ];

                        for (let i = 0; i < count; i++) {
                            const priority = priorityRange[0] + Math.floor(Math.random() * (priorityRange[1] - priorityRange[0]));
                            const daysAgo = Math.floor(Math.random() * 90);
                            const createdDate = new Date();
                            createdDate.setDate(createdDate.getDate() - daysAgo);

                            tickets.push({
                                key: `KSD-${1000 + Math.floor(Math.random() * 9000)}`,
                                summary: summaries[Math.floor(Math.random() * summaries.length)],
                                status: statuses[Math.floor(Math.random() * statuses.length)],
                                created: createdDate.toISOString(),
                                priorityLevel: priority,
                                priorityCategory: priorityCategory,
                                ageInDays: daysAgo
                            });
                        }
                        return tickets;
                    };

                    const highTickets = generateTickets(8, 'high', [1, 9]);
                    const mediumTickets = generateTickets(23, 'medium', [10, 99]);
                    const lowTickets = generateTickets(67, 'low', [100, 500]);
                    const allTickets = [...highTickets, ...mediumTickets, ...lowTickets];

                    return {
                        counts: {
                            high: highTickets.length,
                            medium: mediumTickets.length,
                            low: lowTickets.length,
                            total: allTickets.length
                        },
                        tickets: allTickets.sort((a, b) => new Date(b.created) - new Date(a.created))
                    };
                }

                if (endpoint === 'historical-data') {
                    // Generate time series data based on time period and interval
                    const generateTimeSeries = () => {
                        const series = [];
                        const days = data.timePeriod === 'custom' ? data.customDays : parseInt(data.timePeriod.replace('d', ''));
                        const interval = data.timeInterval || 'daily';
                        
                        let step = 1;
                        if (interval === 'weekly') step = 7;
                        if (interval === 'monthly') step = 30;
                        
                        for (let i = 0; i <= days; i += step) {
                            const date = new Date();
                            date.setDate(date.getDate() - (days - i));
                            
                            const baseHigh = Math.max(1, 12 - Math.floor(i / 5) + Math.floor(Math.random() * 4) - 2);
                            const baseMedium = Math.max(1, 25 - Math.floor(i / 8) + Math.floor(Math.random() * 8) - 4);
                            const baseLow = Math.max(1, 65 - Math.floor(i / 10) + Math.floor(Math.random() * 12) - 6);

                            series.push({
                                date: date.toISOString().split('T')[0],
                                high: baseHigh * (interval === 'weekly' ? 7 : interval === 'monthly' ? 30 : 1),
                                medium: baseMedium * (interval === 'weekly' ? 7 : interval === 'monthly' ? 30 : 1),
                                low: baseLow * (interval === 'weekly' ? 7 : interval === 'monthly' ? 30 : 1),
                                total: (baseHigh + baseMedium + baseLow) * (interval === 'weekly' ? 7 : interval === 'monthly' ? 30 : 1)
                            });
                        }
                        return series;
                    };

                    // Generate source labels time series
                    const generateSourceTimeSeries = () => {
                        const series = [];
                        const days = data.timePeriod === 'custom' ? data.customDays : parseInt(data.timePeriod.replace('d', ''));
                        const interval = data.timeInterval || 'daily';
                        
                        let step = 1;
                        if (interval === 'weekly') step = 7;
                        if (interval === 'monthly') step = 30;
                        
                        for (let i = 0; i <= days; i += step) {
                            const date = new Date();
                            date.setDate(date.getDate() - (days - i));
                            
                            const dayOffset = i / days;
                            const mult = interval === 'weekly' ? 7 : interval === 'monthly' ? 30 : 1;
                            
                            const sourceData = {
                                date: date.toISOString().split('T')[0],
                                'src-bug-fix': Math.max(0, (8 + Math.floor(Math.sin(dayOffset * Math.PI * 2) * 4) + Math.floor(Math.random() * 3)) * mult),
                                'src-golive-critical': Math.max(0, (5 + Math.floor(Math.cos(dayOffset * Math.PI * 1.8) * 3) + Math.floor(Math.random() * 2)) * mult),
                                'src-new-feature': Math.max(0, (4 + Math.floor(Math.cos(dayOffset * Math.PI * 1.5) * 2) + Math.floor(Math.random() * 2)) * mult),
                                'src-integration': Math.max(0, (2 + Math.floor(Math.sin(dayOffset * Math.PI * 2.5) * 1) + Math.floor(Math.random() * 2)) * mult),
                                'src-tech-debt': Math.max(0, (3 + Math.floor(dayOffset * 2) + Math.floor(Math.random() * 2)) * mult),
                                'src-unknown': Math.max(0, (1 + Math.floor(Math.random() * 1)) * mult),
                                'src-maintenance': Math.max(0, (2 + Math.floor(Math.random() * 2)) * mult),
                                'src-enhancement': Math.max(0, (2 + Math.floor(Math.sin(dayOffset * Math.PI * 3) * 2) + Math.floor(Math.random() * 2)) * mult),
                                'src-research': Math.max(0, (1 + Math.floor(Math.cos(dayOffset * Math.PI * 0.5) * 1) + Math.floor(Math.random() * 2)) * mult),
                                'src-critical': Math.max(0, (1 + Math.floor(Math.random() * 2)) * mult)
                            };
                            series.push(sourceData);
                        }
                        return series;
                    };

                    // Generate average age time series
                    const generateAverageAgeTimeSeries = () => {
                        const series = [];
                        const days = data.timePeriod === 'custom' ? data.customDays : parseInt(data.timePeriod.replace('d', ''));
                        const interval = data.timeInterval || 'daily';
                        
                        let step = 1;
                        if (interval === 'weekly') step = 7;
                        if (interval === 'monthly') step = 30;
                        
                        for (let i = 0; i <= days; i += step) {
                            const date = new Date();
                            date.setDate(date.getDate() - (days - i));
                            
                            const dayOffset = i / days;
                            
                            series.push({
                                date: date.toISOString().split('T')[0],
                                highAvgAge: Math.max(5, 15 + Math.floor(dayOffset * 8) + Math.floor(Math.sin(dayOffset * Math.PI * 2) * 5) + Math.floor(Math.random() * 6) - 3),
                                mediumAvgAge: Math.max(10, 35 + Math.floor(dayOffset * 12) + Math.floor(Math.cos(dayOffset * Math.PI * 1.5) * 8) + Math.floor(Math.random() * 10) - 5),
                                lowAvgAge: Math.max(20, 55 + Math.floor(dayOffset * 20) + Math.floor(Math.sin(dayOffset * Math.PI * 0.8) * 10) + Math.floor(Math.random() * 15) - 7)
                            });
                        }
                        return series;
                    };

                    const sourceLabels = [
                        { name: 'Bug Fix', label: 'src-bug-fix', count: 45, percentage: 35, color: '#ef4444' },
                        { name: 'Golive Critical', label: 'src-golive-critical', count: 28, percentage: 22, color: '#dc2626' },
                        { name: 'New Feature', label: 'src-new-feature', count: 18, percentage: 14, color: '#3b82f6' },
                        { name: 'Integration', label: 'src-integration', count: 12, percentage: 9, color: '#0891b2' },
                        { name: 'Tech Debt', label: 'src-tech-debt', count: 10, percentage: 8, color: '#f59e0b' },
                        { name: 'Unknown', label: 'src-unknown', count: 6, percentage: 5, color: '#94a3b8' },
                        { name: 'Maintenance', label: 'src-maintenance', count: 4, percentage: 3, color: '#6b7280' },
                        { name: 'Enhancement', label: 'src-enhancement', count: 3, percentage: 2, color: '#8b5cf6' },
                        { name: 'Research', label: 'src-research', count: 2, percentage: 2, color: '#059669' },
                        { name: 'Critical', label: 'src-critical', count: 1, percentage: 1, color: '#7c2d12' }
                    ].sort((a, b) => b.count - a.count);

                    return {
                        timeSeries: generateTimeSeries(),
                        sourceLabelsTimeSeries: generateSourceTimeSeries(),
                        averageAgeTimeSeries: generateAverageAgeTimeSeries(),
                        sourceLabels
                    };
                }

                throw new Error('Unknown endpoint');
            };

            // API client selector
            const jiraAPI = isProductionMode ? productionJiraAPI : simulateJiraAPI;

            // Helper function to generate JQL query based on time period
            const generateJQL = () => {
                const days = timePeriod === 'custom' ? customDays : timePeriod.replace('d', '');
                return `project = ${jiraConfig.project} AND cf[11129] > 0 AND created >= -${days}d ORDER BY created DESC`;
            };

            // Update JQL when time period changes
            useEffect(() => {
                const newJQL = generateJQL();
                setJiraConfig(prev => ({ ...prev, jqlQuery: newJQL }));
            }, [timePeriod, customDays, jiraConfig.project]);

            // Test connection
            const testConnection = async () => {
                setLoading(true);
                setError(null);
                
                try {
                    await jiraAPI('test-connection', jiraConfig);
                    setConnectionStatus('connected');
                    setLastSync(new Date().toISOString());
                } catch (err) {
                    setConnectionStatus('error');
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            // Fetch data
            const fetchData = async () => {
                if (!jiraConfig.apiToken && isProductionMode) {
                    setError('API Token is required for production mode');
                    return;
                }

                setLoading(true);
                setError(null);

                try {
                    const [currentData, historicalData] = await Promise.all([
                        jiraAPI('current-tickets', { ...jiraConfig, timePeriod, timeInterval }),
                        jiraAPI('historical-data', { ...jiraConfig, timePeriod, timeInterval })
                    ]);

                    setRealData({
                        currentCounts: currentData.counts,
                        tickets: currentData.tickets,
                        historicalTrend: historicalData.timeSeries,
                        sourceLabelsTimeSeries: historicalData.sourceLabelsTimeSeries,
                        averageAgeTimeSeries: historicalData.averageAgeTimeSeries,
                        sourceLabels: historicalData.sourceLabels,
                        lastUpdated: new Date().toISOString()
                    });

                    setConnectionStatus('connected');
                    setLastSync(new Date().toISOString());

                } catch (err) {
                    setError(err.message);
                    setConnectionStatus('error');
                } finally {
                    setLoading(false);
                }
            };

            // Auto-fetch in demo mode
            useEffect(() => {
                if (!isProductionMode) {
                    fetchData();
                }
            }, [isProductionMode]);

            // Auto-refresh when time period or interval changes
            useEffect(() => {
                if (realData && (connectionStatus === 'connected' || !isProductionMode)) {
                    fetchData();
                }
            }, [timePeriod, timeInterval, customDays]);

            // Save config to localStorage whenever it changes
            useEffect(() => {
                try {
                    localStorage.setItem('jiraConfig', JSON.stringify(jiraConfig));
                } catch (e) {
                    console.error('Error saving config:', e);
                }
            }, [jiraConfig]);

            // Custom tooltips
            const CustomTooltip = ({ active, payload, label }) => {
                if (active && payload && payload.length) {
                    return (
                        <div className="bg-white p-3 border border-gray-300 rounded-lg shadow-lg">
                            <p className="font-semibold mb-2">{`Date: ${label}`}</p>
                            {payload.map((entry, index) => (
                                <div key={index} className="flex items-center mb-1">
                                    <div 
                                        className="w-3 h-3 rounded mr-2" 
                                        style={{ backgroundColor: entry.color }}
                                    ></div>
                                    <span className="text-sm">{entry.name}: {entry.value}</span>
                                </div>
                            ))}
                        </div>
                    );
                }
                return null;
            };

            const CustomAgeTooltip = ({ active, payload, label }) => {
                if (active && payload && payload.length) {
                    return (
                        <div className="bg-white p-3 border border-gray-300 rounded-lg shadow-lg">
                            <p className="font-semibold mb-2">{`Date: ${label}`}</p>
                            {payload.map((entry, index) => (
                                <div key={index} className="flex items-center mb-1">
                                    <div 
                                        className="w-3 h-3 rounded mr-2" 
                                        style={{ backgroundColor: entry.color }}
                                    ></div>
                                    <span className="text-sm">{entry.name}: {entry.value} days avg</span>
                                </div>
                            ))}
                        </div>
                    );
                }
                return null;
            };

            const ConnectionStatus = () => {
                const getStatusConfig = () => {
                    switch(connectionStatus) {
                        case 'connected':
                            return {
                                color: 'text-green-600',
                                icon: <CheckIcon />,
                                text: isProductionMode ? 'Connected to Jira' : 'Demo Mode Active'
                            };
                        case 'error':
                            return {
                                color: 'text-red-600',
                                icon: <XIcon />,
                                text: 'Connection Error'
                            };
                        default:
                            return {
                                color: 'text-gray-600',
                                icon: <ClockIcon />,
                                text: 'Not Connected'
                            };
                    }
                };

                const { color, icon, text } = getStatusConfig();

                return (
                    <div className={`flex items-center ${color} text-sm`}>
                        {icon}
                        <span className="ml-2">{text}</span>
                        {lastSync && (
                            <span className="ml-2 text-gray-500">
                                (Last sync: {new Date(lastSync).toLocaleTimeString()})
                            </span>
                        )}
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gray-50 p-4">
                    <div className="max-w-7xl mx-auto space-y-6">
                        
                        {/* Header */}
                        <div className="bg-white shadow-sm border border-gray-200 rounded-lg p-6">
                            <div className="flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0">
                                <div className="flex items-center">
                                    <DatabaseIcon />
                                    <div className="ml-3">
                                        <h1 className="text-2xl font-bold text-gray-900">Jira Analytics Dashboard</h1>
                                        <ConnectionStatus />
                                    </div>
                                </div>
                                
                                <div className="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3">
                                    {/* Mode Toggle */}
                                    <div className="flex items-center space-x-3 px-4 py-2 bg-gray-100 rounded-lg">
                                        <span className={`text-sm font-medium ${!isProductionMode ? 'text-blue-600' : 'text-gray-500'}`}>
                                            Demo
                                        </span>
                                        <label className="toggle-switch">
                                            <input 
                                                type="checkbox" 
                                                checked={isProductionMode}
                                                onChange={(e) => setIsProductionMode(e.target.checked)}
                                            />
                                            <span className="slider"></span>
                                        </label>
                                        <span className={`text-sm font-medium ${isProductionMode ? 'text-green-600' : 'text-gray-500'}`}>
                                            Production
                                        </span>
                                    </div>

                                    {/* Time Period Selector */}
                                    <div className="flex items-center space-x-2 px-4 py-2 bg-gray-100 rounded-lg">
                                        <span className="text-sm font-medium text-gray-700">Period:</span>
                                        <select
                                            value={timePeriod}
                                            onChange={(e) => setTimePeriod(e.target.value)}
                                            className="text-sm border border-gray-300 rounded px-2 py-1"
                                        >
                                            <option value="7d">Last 7 days</option>
                                            <option value="30d">Last 30 days</option>
                                            <option value="90d">Last 90 days</option>
                                            <option value="180d">Last 180 days</option>
                                            <option value="365d">Last year</option>
                                            <option value="custom">Custom</option>
                                        </select>
                                        {timePeriod === 'custom' && (
                                            <input
                                                type="number"
                                                value={customDays}
                                                onChange={(e) => setCustomDays(Math.max(1, parseInt(e.target.value) || 1))}
                                                className="w-16 text-sm border border-gray-300 rounded px-2 py-1"
                                                min="1"
                                                max="730"
                                            />
                                        )}
                                    </div>

                                    {/* Time Interval Selector */}
                                    <div className="flex items-center space-x-2 px-4 py-2 bg-gray-100 rounded-lg">
                                        <span className="text-sm font-medium text-gray-700">Interval:</span>
                                        <select
                                            value={timeInterval}
                                            onChange={(e) => setTimeInterval(e.target.value)}
                                            className="text-sm border border-gray-300 rounded px-2 py-1"
                                        >
                                            <option value="daily">Daily</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="monthly">Monthly</option>
                                        </select>
                                    </div>
                                    
                                    <button
                                        onClick={() => setShowConfig(!showConfig)}
                                        className="flex items-center px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"
                                    >
                                        <SettingsIcon />
                                        <span className="ml-2">{showConfig ? 'Hide Config' : 'Show Config'}</span>
                                    </button>
                                    
                                    <button
                                        onClick={testConnection}
                                        disabled={loading || (isProductionMode && !jiraConfig.apiToken)}
                                        className="flex items-center px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:bg-gray-300"
                                    >
                                        <DatabaseIcon />
                                        <span className="ml-2">Test Connection</span>
                                    </button>
                                    
                                    <button
                                        onClick={fetchData}
                                        disabled={loading || (isProductionMode && !jiraConfig.apiToken)}
                                        className="flex items-center px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-gray-300"
                                    >
                                        <RefreshIcon spinning={loading} />
                                        <span className="ml-2">{loading ? 'Fetching...' : 'Fetch Data'}</span>
                                    </button>
                                </div>
                            </div>

                            {/* Mode Information */}
                            <div className={`mt-4 p-3 rounded-lg border ${
                                isProductionMode 
                                    ? 'bg-green-50 border-green-200' 
                                    : 'bg-blue-50 border-blue-200'
                            }`}>
                                <div className="flex items-start">
                                    <DatabaseIcon />
                                    <div className={`ml-3 text-sm ${
                                        isProductionMode ? 'text-green-800' : 'text-blue-800'
                                    }`}>
                                        {isProductionMode ? (
                                            <>
                                                <p className="font-medium mb-1">Production Mode - Live Jira Connection</p>
                                                <p>Connected to real Jira API endpoints. Requires valid API token and backend server running on localhost:3001.</p>
                                            </>
                                        ) : (
                                            <>
                                                <p className="font-medium mb-1">Demo Mode - Simulated Data</p>
                                                <p>Using realistic simulated data for demonstration. No real Jira connection required.</p>
                                            </>
                                        )}
                                    </div>
                                </div>
                            </div>

                            {/* Configuration Panel */}
                            {showConfig && (
                                <div className="mt-6 p-4 bg-gray-50 rounded-lg border">
                                    <h3 className="text-lg font-semibold mb-4">Jira Connection Settings</h3>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Jira Base URL</label>
                                            <input
                                                type="url"
                                                value={jiraConfig.baseUrl}
                                                onChange={(e) => setJiraConfig(prev => ({ ...prev, baseUrl: e.target.value }))}
                                                className="w-full border border-gray-300 rounded px-3 py-2"
                                                autoComplete="off"
                                                data-lpignore="true"
                                                data-form-type="other"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Email</label>
                                            <input
                                                type="email"
                                                value={jiraConfig.email}
                                                onChange={(e) => setJiraConfig(prev => ({ ...prev, email: e.target.value }))}
                                                className="w-full border border-gray-300 rounded px-3 py-2"
                                                autoComplete="off"
                                                data-lpignore="true"
                                                data-form-type="other"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">
                                                API Token
                                                {jiraConfig.apiToken && (
                                                    <span className="ml-2 text-xs text-green-600 font-normal">
                                                        (Saved locally)
                                                    </span>
                                                )}
                                            </label>
                                            <input
                                                type="password"
                                                value={jiraConfig.apiToken}
                                                onChange={(e) => setJiraConfig(prev => ({ ...prev, apiToken: e.target.value }))}
                                                className="w-full border border-gray-300 rounded px-3 py-2"
                                                placeholder={jiraConfig.apiToken ? "â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" : "Your Jira API token"}
                                                autoComplete="new-password"
                                                data-lpignore="true"
                                                data-form-type="other"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium mb-2">Project Key</label>
                                            <input
                                                type="text"
                                                value={jiraConfig.project}
                                                onChange={(e) => setJiraConfig(prev => ({ ...prev, project: e.target.value }))}
                                                className="w-full border border-gray-300 rounded px-3 py-2"
                                                autoComplete="off"
                                                data-lpignore="true"
                                                data-form-type="other"
                                            />
                                        </div>
                                    </div>
                                    
                                    {/* JQL Query Section */}
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-2">JQL Query</label>
                                        <textarea
                                            value={jiraConfig.jqlQuery}
                                            onChange={(e) => setJiraConfig(prev => ({ ...prev, jqlQuery: e.target.value }))}
                                            className="w-full h-24 border border-gray-300 rounded px-3 py-2 font-mono text-sm"
                                            placeholder="project = KSD AND cf[11129] > 0 AND created >= -30d ORDER BY created DESC"
                                            autoComplete="off"
                                            data-lpignore="true"
                                            data-form-type="other"
                                        />
                                        <div className="mt-2 text-xs text-gray-600">
                                            <strong>Default Query:</strong> All KSD tickets with Priority Level > 0 created in last 30 days
                                        </div>
                                        <div className="mt-1 text-xs text-blue-600">
                                            <strong>Tips:</strong> Use cf[11129] for Priority Level field â€¢ Use -30d for last 30 days â€¢ Add ORDER BY for sorting
                                        </div>
                                    </div>

                                    {/* Quick JQL Templates */}
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium mb-2">Quick JQL Templates</label>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                                            {[
                                                {
                                                    name: 'High Priority (PL < 10)',
                                                    query: () => `project = ${jiraConfig.project} AND cf[11129] < 10 AND status not in ("Done", "Closed") ORDER BY cf[11129] ASC`
                                                },
                                                {
                                                    name: 'Current Time Period',
                                                    query: () => generateJQL()
                                                },
                                                {
                                                    name: 'Source Label Analysis',
                                                    query: () => `project = ${jiraConfig.project} AND labels in ("src-bug-fix", "src-new-feature", "src-tech-debt") AND created >= -${timePeriod === 'custom' ? customDays : timePeriod.replace('d', '')}d`
                                                },
                                                {
                                                    name: 'All Active Tickets',
                                                    query: () => `project = ${jiraConfig.project} AND status not in ("Done", "Closed", "Resolved") ORDER BY cf[11129] ASC`
                                                }
                                            ].map((template, index) => (
                                                <button
                                                    key={index}
                                                    onClick={() => setJiraConfig(prev => ({ ...prev, jqlQuery: typeof template.query === 'function' ? template.query() : template.query }))}
                                                    className="text-left p-2 border border-gray-200 rounded hover:bg-blue-50 hover:border-blue-300"
                                                >
                                                    <div className="font-medium text-sm text-blue-700">{template.name}</div>
                                                    <div className="text-xs text-gray-500 font-mono truncate">{typeof template.query === 'function' ? template.query() : template.query}</div>
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    
                                    {!jiraConfig.apiToken && isProductionMode && (
                                        <div className="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded text-yellow-700">
                                            <strong>Production Mode Requires Setup:</strong> Get your API token from{' '}
                                            <a href="https://id.atlassian.com/manage-profile/security/api-tokens" 
                                               className="text-blue-600 underline" target="_blank" rel="noopener noreferrer">
                                                Atlassian Account Settings
                                            </a>
                                        </div>
                                    )}
                                    
                                    {jiraConfig.apiToken && (
                                        <div className="mt-4 flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded">
                                            <span className="text-green-700">
                                                <strong>API Token Saved:</strong> Your credentials are stored locally
                                            </span>
                                            <button
                                                onClick={() => {
                                                    if (confirm('Are you sure you want to clear your saved API token?')) {
                                                        setJiraConfig(prev => ({ ...prev, apiToken: '' }));
                                                    }
                                                }}
                                                className="text-sm px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600"
                                            >
                                                Clear Token
                                            </button>
                                        </div>
                                    )}
                                </div>
                            )}

                            {error && (
                                <div className="mt-4 p-3 bg-red-50 border border-red-200 rounded text-red-700">
                                    <strong>Error:</strong> {error}
                                </div>
                            )}

                        </div>

                        {/* Current Status Cards */}
                        {realData && (
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-red-600 text-sm font-medium">High Priority</p>
                                            <p className="text-3xl font-bold text-red-700">{realData.currentCounts?.high || 0}</p>
                                        </div>
                                        <AlertIcon />
                                    </div>
                                </div>
                                <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-yellow-600 text-sm font-medium">Medium Priority</p>
                                            <p className="text-3xl font-bold text-yellow-700">{realData.currentCounts?.medium || 0}</p>
                                        </div>
                                        <TrendingIcon />
                                    </div>
                                </div>
                                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-blue-600 text-sm font-medium">Low Priority</p>
                                            <p className="text-3xl font-bold text-blue-700">{realData.currentCounts?.low || 0}</p>
                                        </div>
                                        <ClockIcon />
                                    </div>
                                </div>
                                <div className="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-gray-600 text-sm font-medium">Total Active</p>
                                            <p className="text-3xl font-bold text-gray-700">{realData.currentCounts?.total || 0}</p>
                                        </div>
                                        <DatabaseIcon />
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Historical Trend Chart */}
                        {realData && realData.historicalTrend && (
                            <div className="chart-container p-6">
                                <h3 className="text-lg font-semibold mb-4">
                                    Historical Ticket Trends ({jiraConfig.project} Project) - {
                                        timePeriod === 'custom' ? `Last ${customDays} days` : 
                                        timePeriod === '7d' ? 'Last 7 days' :
                                        timePeriod === '30d' ? 'Last 30 days' :
                                        timePeriod === '90d' ? 'Last 90 days' :
                                        timePeriod === '180d' ? 'Last 180 days' :
                                        timePeriod === '365d' ? 'Last year' : ''
                                    } ({timeInterval === 'daily' ? 'Daily' : timeInterval === 'weekly' ? 'Weekly' : 'Monthly'})
                                </h3>
                                <ResponsiveContainer width="100%" height={300}>
                                    <LineChart data={realData.historicalTrend}>
                                        <CartesianGrid strokeDasharray="3 3" />
                                        <XAxis 
                                            dataKey="date" 
                                            angle={timeInterval === 'monthly' ? -45 : 0}
                                            textAnchor={timeInterval === 'monthly' ? 'end' : 'middle'}
                                            height={timeInterval === 'monthly' ? 60 : 30}
                                        />
                                        <YAxis />
                                        <Tooltip content={<CustomTooltip />} />
                                        <Legend />
                                        <Line type="monotone" dataKey="high" stroke="#ef4444" strokeWidth={2} name="High Priority" />
                                        <Line type="monotone" dataKey="medium" stroke="#f59e0b" strokeWidth={2} name="Medium Priority" />
                                        <Line type="monotone" dataKey="low" stroke="#3b82f6" strokeWidth={2} name="Low Priority" />
                                        <Line type="monotone" dataKey="total" stroke="#6b7280" strokeWidth={2} name="Total" />
                                    </LineChart>
                                </ResponsiveContainer>
                            </div>
                        )}

                        {/* Source Labels Analysis */}
                        {realData && (
                            <div className="chart-container p-6">
                                <h3 className="text-lg font-semibold mb-4">Source Label Analysis Over Time</h3>
                                
                                {/* Stacked Bar Chart */}
                                {realData.sourceLabelsTimeSeries && (
                                    <div className="mb-6">
                                        <h4 className="font-medium mb-3">Source Distribution Over Time (Stacked)</h4>
                                        <ResponsiveContainer width="100%" height={350}>
                                            <BarChart data={realData.sourceLabelsTimeSeries}>
                                                <CartesianGrid strokeDasharray="3 3" />
                                                <XAxis dataKey="date" />
                                                <YAxis />
                                                <Tooltip content={<CustomTooltip />} />
                                                <Legend />
                                                {realData.sourceLabels?.map((source, index) => (
                                                    <Bar 
                                                        key={source.label} 
                                                        dataKey={source.label} 
                                                        stackId="a" 
                                                        fill={source.color} 
                                                        name={source.name} 
                                                    />
                                                ))}
                                            </BarChart>
                                        </ResponsiveContainer>
                                    </div>
                                )}

                                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                    {/* Average Age Time Series */}
                                    {realData.averageAgeTimeSeries && (
                                        <div>
                                            <h4 className="font-medium mb-3">Average Ticket Age Trends</h4>
                                            <ResponsiveContainer width="100%" height={250}>
                                                <LineChart data={realData.averageAgeTimeSeries}>
                                                    <CartesianGrid strokeDasharray="3 3" />
                                                    <XAxis dataKey="date" />
                                                    <YAxis />
                                                    <Tooltip content={<CustomAgeTooltip />} />
                                                    <Legend />
                                                    <Line type="monotone" dataKey="highAvgAge" stroke="#ef4444" strokeWidth={2} name="High Priority" />
                                                    <Line type="monotone" dataKey="mediumAvgAge" stroke="#f59e0b" strokeWidth={2} name="Medium Priority" />
                                                    <Line type="monotone" dataKey="lowAvgAge" stroke="#3b82f6" strokeWidth={2} name="Low Priority" />
                                                </LineChart>
                                            </ResponsiveContainer>
                                        </div>
                                    )}
                                    
                                    {/* Source Labels Time Series */}
                                    {realData.sourceLabelsTimeSeries && (
                                        <div>
                                            <h4 className="font-medium mb-3">Source Distribution (Last 14 Days)</h4>
                                            <ResponsiveContainer width="100%" height={250}>
                                                <BarChart data={realData.sourceLabelsTimeSeries.slice(-14)}>
                                                    <CartesianGrid strokeDasharray="3 3" />
                                                    <XAxis 
                                                        dataKey="date" 
                                                        tick={{ fontSize: 10 }}
                                                        angle={-45}
                                                        textAnchor="end"
                                                        height={60}
                                                    />
                                                    <YAxis />
                                                    <Tooltip content={<CustomTooltip />} />
                                                    <Legend />
                                                    {realData.sourceLabels?.slice(0, 8).map((source, index) => (
                                                        <Bar 
                                                            key={source.label} 
                                                            dataKey={source.label} 
                                                            stackId="a" 
                                                            fill={source.color} 
                                                            name={source.name} 
                                                        />
                                                    ))}
                                                </BarChart>
                                            </ResponsiveContainer>
                                        </div>
                                    )}
                                </div>
                                
                                {/* Summary Grid */}
                                <div className="mt-6">
                                    <h4 className="font-medium mb-3">Source Label Summary</h4>
                                    <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3">
                                        {realData.sourceLabels?.map((source, index) => (
                                            <div key={index} className="p-3 bg-gray-50 rounded-lg text-center">
                                                <div 
                                                    className="w-4 h-4 rounded mx-auto mb-2" 
                                                    style={{ backgroundColor: source.color }}
                                                ></div>
                                                <div className="font-medium text-sm">{source.name}</div>
                                                <div className="font-bold text-lg">{source.count}</div>
                                                <div className="text-xs text-gray-500">{source.percentage}%</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Recent Tickets Table with Transition History */}
                        {realData && realData.tickets && (
                            <div className="chart-container p-6">
                                <h3 className="text-lg font-semibold mb-4">Recent Tickets from {jiraConfig.project}</h3>
                                <div className="overflow-x-auto">
                                    <table className="w-full text-sm">
                                        <thead>
                                            <tr className="border-b">
                                                <th className="text-left py-2">Key</th>
                                                <th className="text-left py-2">Summary</th>
                                                <th className="text-left py-2">Current Status</th>
                                                <th className="text-left py-2">Current PL</th>
                                                <th className="text-left py-2">Transitions</th>
                                                <th className="text-left py-2">Age (Days)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {realData.tickets.slice(0, 10).map((ticket, index) => (
                                                <tr key={index} className="border-b hover:bg-gray-50">
                                                    <td className="py-2 font-medium text-blue-600">{ticket.key}</td>
                                                    <td className="py-2 max-w-xs truncate" title={ticket.summary}>{ticket.summary}</td>
                                                    <td className="py-2">
                                                        <div className="flex flex-col">
                                                            <span className="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs mb-1">
                                                                {ticket.currentStatus?.value || ticket.status}
                                                            </span>
                                                            {ticket.currentStatus?.lastChangedBy && (
                                                                <span className="text-xs text-gray-500">
                                                                    by {ticket.currentStatus.lastChangedBy}
                                                                </span>
                                                            )}
                                                        </div>
                                                    </td>
                                                    <td className="py-2">
                                                        <div className="flex flex-col">
                                                            <span className={`px-2 py-1 rounded text-xs mb-1 ${
                                                                (ticket.currentPriorityLevel?.value || ticket.priorityLevel) < 10 
                                                                    ? 'bg-red-100 text-red-800' 
                                                                    : (ticket.currentPriorityLevel?.value || ticket.priorityLevel) < 100 
                                                                    ? 'bg-yellow-100 text-yellow-800'
                                                                    : 'bg-blue-100 text-blue-800'
                                                            }`}>
                                                                {ticket.currentPriorityLevel?.value || ticket.priorityLevel || 'N/A'}
                                                            </span>
                                                            {ticket.currentPriorityLevel?.lastChangedBy && (
                                                                <span className="text-xs text-gray-500">
                                                                    by {ticket.currentPriorityLevel.lastChangedBy}
                                                                </span>
                                                            )}
                                                        </div>
                                                    </td>
                                                    <td className="py-2">
                                                        <div className="text-xs text-gray-600">
                                                            <div>Status: {ticket.totalStatusTransitions || 0}</div>
                                                            <div>PL: {ticket.totalPriorityLevelTransitions || 0}</div>
                                                            <div>Labels: {ticket.totalLabelTransitions || 0}</div>
                                                        </div>
                                                    </td>
                                                    <td className="py-2">{ticket.ageInDays}</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* Transition History Analysis */}
                        {realData && realData.tickets && (
                            <div className="chart-container p-6">
                                <h3 className="text-lg font-semibold mb-4">Transition Analysis</h3>
                                
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                    {/* Status Transition Summary */}
                                    <div className="bg-blue-50 p-4 rounded-lg">
                                        <h4 className="font-medium text-blue-800 mb-2">Status Transitions</h4>
                                        <div className="text-2xl font-bold text-blue-900">
                                            {realData.tickets.reduce((sum, ticket) => sum + (ticket.totalStatusTransitions || 0), 0)}
                                        </div>
                                        <div className="text-sm text-blue-600">
                                            Avg: {(realData.tickets.reduce((sum, ticket) => sum + (ticket.totalStatusTransitions || 0), 0) / realData.tickets.length).toFixed(1)} per ticket
                                        </div>
                                    </div>

                                    {/* Priority Level Transition Summary */}
                                    <div className="bg-yellow-50 p-4 rounded-lg">
                                        <h4 className="font-medium text-yellow-800 mb-2">Priority Level Changes</h4>
                                        <div className="text-2xl font-bold text-yellow-900">
                                            {realData.tickets.reduce((sum, ticket) => sum + (ticket.totalPriorityLevelTransitions || 0), 0)}
                                        </div>
                                        <div className="text-sm text-yellow-600">
                                            Avg: {(realData.tickets.reduce((sum, ticket) => sum + (ticket.totalPriorityLevelTransitions || 0), 0) / realData.tickets.length).toFixed(1)} per ticket
                                        </div>
                                    </div>

                                    {/* Label Transition Summary */}
                                    <div className="bg-green-50 p-4 rounded-lg">
                                        <h4 className="font-medium text-green-800 mb-2">Label Changes</h4>
                                        <div className="text-2xl font-bold text-green-900">
                                            {realData.tickets.reduce((sum, ticket) => sum + (ticket.totalLabelTransitions || 0), 0)}
                                        </div>
                                        <div className="text-sm text-green-600">
                                            Avg: {(realData.tickets.reduce((sum, ticket) => sum + (ticket.totalLabelTransitions || 0), 0) / realData.tickets.length).toFixed(1)} per ticket
                                        </div>
                                    </div>
                                </div>

                                {/* Most Active Tickets */}
                                <div>
                                    <h4 className="font-medium mb-3">Most Active Tickets (by total transitions)</h4>
                                    <div className="overflow-x-auto">
                                        <table className="w-full text-sm">
                                            <thead>
                                                <tr className="border-b bg-gray-50">
                                                    <th className="text-left py-2 px-2">Ticket</th>
                                                    <th className="text-left py-2 px-2">Status Changes</th>
                                                    <th className="text-left py-2 px-2">PL Changes</th>
                                                    <th className="text-left py-2 px-2">Label Changes</th>
                                                    <th className="text-left py-2 px-2">Total Activity</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {realData.tickets
                                                    .map(ticket => ({
                                                        ...ticket,
                                                        totalActivity: (ticket.totalStatusTransitions || 0) + 
                                                                     (ticket.totalPriorityLevelTransitions || 0) + 
                                                                     (ticket.totalLabelTransitions || 0)
                                                    }))
                                                    .filter(ticket => ticket.totalActivity > 0)
                                                    .sort((a, b) => b.totalActivity - a.totalActivity)
                                                    .slice(0, 5)
                                                    .map((ticket, index) => (
                                                        <tr key={index} className="border-b hover:bg-gray-50">
                                                            <td className="py-2 px-2 font-medium text-blue-600">{ticket.key}</td>
                                                            <td className="py-2 px-2 text-center">{ticket.totalStatusTransitions || 0}</td>
                                                            <td className="py-2 px-2 text-center">{ticket.totalPriorityLevelTransitions || 0}</td>
                                                            <td className="py-2 px-2 text-center">{ticket.totalLabelTransitions || 0}</td>
                                                            <td className="py-2 px-2 text-center font-bold">{ticket.totalActivity}</td>
                                                        </tr>
                                                    ))
                                                }
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* No Data State */}
                        {!realData && !loading && (
                            <div className="chart-container p-12 text-center">
                                <DatabaseIcon />
                                <h3 className="text-lg font-medium text-gray-900 mb-2">No Data Loaded</h3>
                                <p className="text-gray-500 mb-6">
                                    {isProductionMode 
                                        ? (!jiraConfig.apiToken 
                                            ? 'Configure your Jira API token and click "Fetch Data" to load live ticket information.'
                                            : 'Click "Fetch Data" to load your Jira tickets and analytics.')
                                        : 'Click "Fetch Data" to load demo analytics data, or switch to Production mode for live Jira data.'
                                    }
                                </p>
                                <button
                                    onClick={fetchData}
                                    className="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600"
                                >
                                    {isProductionMode ? 'Load Live Data' : 'Load Demo Data'}
                                </button>
                            </div>
                        )}

                    </div>
                </div>
            );
        };

        // Load Recharts and render the app
        console.log('Charts available:', ChartsAvailable);
        ReactDOM.render(<JiraAnalyticsApp />, document.getElementById('root'));
    </script>
</body>
</html>
    </script>
</body>
</html>